<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2022-05-27">
<meta name="description" content="Efficient &amp; blazing fast SQL analytics in Pandas with DuckDB">

<title>Saṃsāra - Supercharge your data processing with DuckDB</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Saṃsāra</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/samsaara"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Supercharge your data processing with DuckDB</h1>
                  <div>
        <div class="description">
          Efficient &amp; blazing fast SQL analytics in Pandas with DuckDB
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">EDA</div>
                <div class="quarto-category">SQL</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 27, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a>
  <ul class="collapse">
  <li><a href="#jupyter-notebook-setup" id="toc-jupyter-notebook-setup" class="nav-link" data-scroll-target="#jupyter-notebook-setup">Jupyter Notebook setup</a></li>
  </ul></li>
  <li><a href="#duckdb-vs-traditional-databases" id="toc-duckdb-vs-traditional-databases" class="nav-link" data-scroll-target="#duckdb-vs-traditional-databases">DuckDB vs traditional Databases</a></li>
  </ul></li>
  <li><a href="#accessing-dataframes-with-duckdb" id="toc-accessing-dataframes-with-duckdb" class="nav-link" data-scroll-target="#accessing-dataframes-with-duckdb">Accessing DataFrames with DuckDB</a></li>
  <li><a href="#accessing-files-with-duckdb" id="toc-accessing-files-with-duckdb" class="nav-link" data-scroll-target="#accessing-files-with-duckdb">Accessing files with DuckDB</a>
  <ul class="collapse">
  <li><a href="#projection-filter-pushdowns" id="toc-projection-filter-pushdowns" class="nav-link" data-scroll-target="#projection-filter-pushdowns">Projection &amp; Filter Pushdowns</a></li>
  <li><a href="#using-groupby" id="toc-using-groupby" class="nav-link" data-scroll-target="#using-groupby">Using Groupby</a></li>
  </ul></li>
  <li><a href="#accessing-data-with-views" id="toc-accessing-data-with-views" class="nav-link" data-scroll-target="#accessing-data-with-views">Accessing data with <code>Views</code></a>
  <ul class="collapse">
  <li><a href="#using-approximations" id="toc-using-approximations" class="nav-link" data-scroll-target="#using-approximations">Using approximations</a></li>
  <li><a href="#using-window-functions" id="toc-using-window-functions" class="nav-link" data-scroll-target="#using-window-functions">Using Window functions</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a>
  <ul class="collapse">
  <li><a href="#sidenote" id="toc-sidenote" class="nav-link" data-scroll-target="#sidenote">Sidenote</a></li>
  </ul></li>
  <li><a href="#footnotes" id="toc-footnotes" class="nav-link" data-scroll-target="#footnotes">Footnotes</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>Do you have large datasets that you simply can not load into memory to analyse with Pandas? Or do you feel more comfortable expressing operations in SQL instead of python?</p>
<p>Fret not, for you have <code>DuckDB</code> now! ✨🦆✨</p>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Most of us data scientists are familiar with Pandas, the de-facto data processing library in Python. It’s simple, powerful, able to handle a myriad data formats &amp; sizes and for the most part, very intuitive. And people familiar with SQL as well know how powerful it too is in its ability to handle complex data transformations with a concise syntax. But sometimes, you have to trade off execution speeds in favor of intuitivity/expressiveness or vice versa. This especially becomes painful when you either have large (OOM) datasets or need to perform complex data wrangling on your data. At times, it makes more sense to handle that in SQL rather than in Pandas.</p>
<p>DuckDB aims to bring these together with a fast &amp; efficient SQL query execution engine that can run complex queries on large sets of data. It integrates tightly with Pandas DataFrames and allows us to run these queries directly on top of them without needing to take data in &amp; out of it.</p>
<p>In this tutorial, we shall see how we can leverage DuckDB in various analytical workloads.</p>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>DuckDB is very lightweight and has <strong><em>no external dependencies</em></strong> and runs <em>within</em> the host process itself. Simply install it with:</p>
<pre><code>pip install duckdb==0.3.4</code></pre>
<p>To initialize it, run:</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2022-05-27T19:33:34.991241Z&quot;,&quot;start_time&quot;:&quot;2022-05-27T19:33:34.436037Z&quot;}" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> duckdb</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>dbcon <span class="op">=</span> duckdb.<span class="ex">connect</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>That’s it! Now you can test it by running:</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2022-05-27T19:33:36.016219Z&quot;,&quot;start_time&quot;:&quot;2022-05-27T19:33:35.992090Z&quot;}" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>dbcon.execute(<span class="st">'select 1, 2, 3'</span>).fetchall()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>[(1, 2, 3)]</code></pre>
</div>
</div>
<p>Next step is to run <code>pip install pyarrow</code> to add support for reading/writing <em>parquet</em> data.</p>
<section id="jupyter-notebook-setup" class="level3">
<h3 class="anchored" data-anchor-id="jupyter-notebook-setup">Jupyter Notebook setup</h3>
<p>If in case you wish to explore it in Jupyter Notebooks, install a few additional libraries for a better experience:</p>
<pre><code>pip install ipython-sql SQLAlchemy duckdb-engine</code></pre>
<p>Import them once installed:</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2022-05-27T19:33:40.106943Z&quot;,&quot;start_time&quot;:&quot;2022-05-27T19:33:36.943288Z&quot;}" data-execution_count="3">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlalchemy</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext sql</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Set a few config options to prettify the output and return it as Pandas DataFrame</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2022-05-27T19:33:40.130019Z&quot;,&quot;start_time&quot;:&quot;2022-05-27T19:33:40.109333Z&quot;}" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>config SqlMagic.autopandas <span class="op">=</span> <span class="va">True</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>config SqlMagic.feedback <span class="op">=</span> <span class="va">False</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>config SqlMagic.displaycon <span class="op">=</span> <span class="va">False</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>DuckDB is primarily designed to be an in-memory DB. You can however persist your data to disk.</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2022-05-27T19:33:40.405754Z&quot;,&quot;start_time&quot;:&quot;2022-05-27T19:33:40.132674Z&quot;}" data-execution_count="5">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>sql duckdb:<span class="op">///</span>:memory:</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># %sql duckdb:///path/to/file.db</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2022-05-27T19:33:41.343052Z&quot;,&quot;start_time&quot;:&quot;2022-05-27T19:33:41.318366Z&quot;}" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#collapse-output</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># we can also access the current config &amp; settings of DuckDB by running the following:</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>sql SELECT <span class="op">*</span> FROM duckdb_settings()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>name</th>
      <th>value</th>
      <th>description</th>
      <th>input_type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>access_mode</td>
      <td>automatic</td>
      <td>Access mode of the database (AUTOMATIC, READ_O...</td>
      <td>VARCHAR</td>
    </tr>
    <tr>
      <th>1</th>
      <td>checkpoint_threshold</td>
      <td>16.7MB</td>
      <td>The WAL size threshold at which to automatical...</td>
      <td>VARCHAR</td>
    </tr>
    <tr>
      <th>2</th>
      <td>debug_checkpoint_abort</td>
      <td>NULL</td>
      <td>DEBUG SETTING: trigger an abort while checkpoi...</td>
      <td>VARCHAR</td>
    </tr>
    <tr>
      <th>3</th>
      <td>debug_force_external</td>
      <td>False</td>
      <td>DEBUG SETTING: force out-of-core computation f...</td>
      <td>BOOLEAN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>debug_many_free_list_blocks</td>
      <td>False</td>
      <td>DEBUG SETTING: add additional blocks to the fr...</td>
      <td>BOOLEAN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>debug_window_mode</td>
      <td>NULL</td>
      <td>DEBUG SETTING: switch window mode to use</td>
      <td>VARCHAR</td>
    </tr>
    <tr>
      <th>6</th>
      <td>default_collation</td>
      <td></td>
      <td>The collation setting used when none is specified</td>
      <td>VARCHAR</td>
    </tr>
    <tr>
      <th>7</th>
      <td>default_order</td>
      <td>asc</td>
      <td>The order type used when none is specified (AS...</td>
      <td>VARCHAR</td>
    </tr>
    <tr>
      <th>8</th>
      <td>default_null_order</td>
      <td>nulls_first</td>
      <td>Null ordering used when none is specified (NUL...</td>
      <td>VARCHAR</td>
    </tr>
    <tr>
      <th>9</th>
      <td>disabled_optimizers</td>
      <td></td>
      <td>DEBUG SETTING: disable a specific set of optim...</td>
      <td>VARCHAR</td>
    </tr>
    <tr>
      <th>10</th>
      <td>enable_external_access</td>
      <td>True</td>
      <td>Allow the database to access external state (t...</td>
      <td>BOOLEAN</td>
    </tr>
    <tr>
      <th>11</th>
      <td>enable_object_cache</td>
      <td>False</td>
      <td>Whether or not object cache is used to cache e...</td>
      <td>BOOLEAN</td>
    </tr>
    <tr>
      <th>12</th>
      <td>enable_profiling</td>
      <td>NULL</td>
      <td>Enables profiling, and sets the output format ...</td>
      <td>VARCHAR</td>
    </tr>
    <tr>
      <th>13</th>
      <td>enable_progress_bar</td>
      <td>False</td>
      <td>Enables the progress bar, printing progress to...</td>
      <td>BOOLEAN</td>
    </tr>
    <tr>
      <th>14</th>
      <td>explain_output</td>
      <td>physical_only</td>
      <td>Output of EXPLAIN statements (ALL, OPTIMIZED_O...</td>
      <td>VARCHAR</td>
    </tr>
    <tr>
      <th>15</th>
      <td>force_compression</td>
      <td>NULL</td>
      <td>DEBUG SETTING: forces a specific compression m...</td>
      <td>VARCHAR</td>
    </tr>
    <tr>
      <th>16</th>
      <td>log_query_path</td>
      <td>NULL</td>
      <td>Specifies the path to which queries should be ...</td>
      <td>VARCHAR</td>
    </tr>
    <tr>
      <th>17</th>
      <td>max_memory</td>
      <td>26.9GB</td>
      <td>The maximum memory of the system (e.g. 1GB)</td>
      <td>VARCHAR</td>
    </tr>
    <tr>
      <th>18</th>
      <td>memory_limit</td>
      <td>26.9GB</td>
      <td>The maximum memory of the system (e.g. 1GB)</td>
      <td>VARCHAR</td>
    </tr>
    <tr>
      <th>19</th>
      <td>null_order</td>
      <td>nulls_first</td>
      <td>Null ordering used when none is specified (NUL...</td>
      <td>VARCHAR</td>
    </tr>
    <tr>
      <th>20</th>
      <td>perfect_ht_threshold</td>
      <td>12</td>
      <td>Threshold in bytes for when to use a perfect h...</td>
      <td>BIGINT</td>
    </tr>
    <tr>
      <th>21</th>
      <td>preserve_identifier_case</td>
      <td>True</td>
      <td>Whether or not to preserve the identifier case...</td>
      <td>BOOLEAN</td>
    </tr>
    <tr>
      <th>22</th>
      <td>profiler_history_size</td>
      <td>NULL</td>
      <td>Sets the profiler history size</td>
      <td>BIGINT</td>
    </tr>
    <tr>
      <th>23</th>
      <td>profile_output</td>
      <td></td>
      <td>The file to which profile output should be sav...</td>
      <td>VARCHAR</td>
    </tr>
    <tr>
      <th>24</th>
      <td>profiling_mode</td>
      <td>NULL</td>
      <td>The profiling mode (STANDARD or DETAILED)</td>
      <td>VARCHAR</td>
    </tr>
    <tr>
      <th>25</th>
      <td>profiling_output</td>
      <td></td>
      <td>The file to which profile output should be sav...</td>
      <td>VARCHAR</td>
    </tr>
    <tr>
      <th>26</th>
      <td>progress_bar_time</td>
      <td>2000</td>
      <td>Sets the time (in milliseconds) how long a que...</td>
      <td>BIGINT</td>
    </tr>
    <tr>
      <th>27</th>
      <td>schema</td>
      <td></td>
      <td>Sets the default search schema. Equivalent to ...</td>
      <td>VARCHAR</td>
    </tr>
    <tr>
      <th>28</th>
      <td>search_path</td>
      <td></td>
      <td>Sets the default search search path as a comma...</td>
      <td>VARCHAR</td>
    </tr>
    <tr>
      <th>29</th>
      <td>temp_directory</td>
      <td>.tmp</td>
      <td>Set the directory to which to write temp files</td>
      <td>VARCHAR</td>
    </tr>
    <tr>
      <th>30</th>
      <td>threads</td>
      <td>12</td>
      <td>The number of total threads used by the system.</td>
      <td>BIGINT</td>
    </tr>
    <tr>
      <th>31</th>
      <td>wal_autocheckpoint</td>
      <td>16.7MB</td>
      <td>The WAL size threshold at which to automatical...</td>
      <td>VARCHAR</td>
    </tr>
    <tr>
      <th>32</th>
      <td>worker_threads</td>
      <td>12</td>
      <td>The number of total threads used by the system.</td>
      <td>BIGINT</td>
    </tr>
    <tr>
      <th>33</th>
      <td>binary_as_string</td>
      <td></td>
      <td>In Parquet files, interpret binary data as a s...</td>
      <td>BOOLEAN</td>
    </tr>
    <tr>
      <th>34</th>
      <td>Calendar</td>
      <td>gregorian</td>
      <td>The current calendar</td>
      <td>VARCHAR</td>
    </tr>
    <tr>
      <th>35</th>
      <td>TimeZone</td>
      <td>Europe/Berlin</td>
      <td>The current time zone</td>
      <td>VARCHAR</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>From now on, you can run SQL directly by prefixing <code>%sql</code> (or <code>%%sql</code> for multiline statements) to your code cell and get your output returned as pandas dataframe :man_dancing:.</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2022-05-27T19:33:43.949965Z&quot;,&quot;start_time&quot;:&quot;2022-05-27T19:33:43.936516Z&quot;}" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>sql select <span class="dv">1</span> <span class="im">as</span> a<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>a</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="duckdb-vs-traditional-databases" class="level2">
<h2 class="anchored" data-anchor-id="duckdb-vs-traditional-databases">DuckDB vs traditional Databases</h2>
<p>With <code>pandas.read_sql</code> command, one can already run SQL queries on an existing DB connection, read tables and load data as pandas DataFrames in memory for processing in python. While this is fine for lightweight operations, it is not optimized for heavy data processing. Traditional RDBMSs such as Postgres, MySQL, etc. process each row sequentially which apart from taking long time to execute, also induce a lot of overhead on CPU. DuckDB on the other hand is built with <a href="https://en.wikipedia.org/wiki/Online_analytical_processing">OLAP</a> in mind and is <em>Column-Vectorized</em>. This helps massively parallelize disk I/O and query executions.</p>
<blockquote class="blockquote">
<p>DuckDB uses the Postgres SQL parser under the hood, and offers many of the same SQL features as Postgres <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
</blockquote>
</section>
</section>
<section id="accessing-dataframes-with-duckdb" class="level1">
<h1>Accessing DataFrames with DuckDB</h1>
<p>One of the major limitations of Pandas is that it’s <em>single threaded</em>. Hence we can’t take advantage of the multi-core CPUs which every computer ships with these days. DuckDB <strong><em>supports multi-threading</em></strong> natively and hence can take advantage of all the cores of your CPU.</p>
<blockquote class="blockquote">
<p>There exist a few some external libraries that enable parallel processing but only on specific operations.</p>
</blockquote>
<p>While this is turned on by default, we also can explicitly set the number of threads:</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2022-05-27T19:33:45.545681Z&quot;,&quot;start_time&quot;:&quot;2022-05-27T19:33:45.487404Z&quot;}" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#collapse-output</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># specify no. of threads for multi-threading support</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># dbcon.execute("PRAGMA threads=32");</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># you can also set this up with the `%sql` line magic</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>sql SET THREADS to <span class="dv">32</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div>
</div>
</div>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>When using free tier of Google Colab, please set it only to <code>2</code> to avoid crashing the kernel instead.</p>
</div>
</div>
<p>We can also write a short snippet to run an SQL query, and return the result as a Pandas DataFrame in a pythonic way:</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2022-05-27T19:33:48.373995Z&quot;,&quot;start_time&quot;:&quot;2022-05-27T19:33:48.367971Z&quot;}" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dbrun(query: <span class="bu">str</span>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""run the query with duckdb"""</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> dbcon.query(query).to_df()</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># you can also use `fetch` instead</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># result = dbcon.execute(query).fetch_df()</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># or just simply `.df()`</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># result = dbcon.execute(query).df()</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now create a DataFrame &amp; run a simple query:</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2022-05-27T19:33:48.708828Z&quot;,&quot;start_time&quot;:&quot;2022-05-27T19:33:48.647014Z&quot;}" data-execution_count="11">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(<span class="bu">range</span>(<span class="dv">10</span>), columns<span class="op">=</span>[<span class="st">'a'</span>])</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># querying with python function</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>first_half_df <span class="op">=</span> dbrun(<span class="st">"""</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT *</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM df</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="st">    WHERE a &lt; 5</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Alternatively, you can also compute the result with the line magics and store the result as a python variable that you can access elsewhere:</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2022-05-27T19:33:55.512332Z&quot;,&quot;start_time&quot;:&quot;2022-05-27T19:33:55.481003Z&quot;}" data-execution_count="13">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#collapse-output</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>second_half_df <span class="op">&lt;&lt;</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>SELECT <span class="op">*</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>FROM df</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>WHERE a <span class="op">&gt;=</span> <span class="dv">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Returning data to local variable second_half_df</code></pre>
</div>
</div>
<p>Notice that we didn’t declare <code>df</code> as a view, nor did we create any table. DuckDB simply looks for any python variable that was declared before if the table name doesn’t exist.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Sometimes, you override a dataframe by performing an operation &amp; assign it to the same variable. For e.g., <code>df = df.query(...)</code>. If in case, you see that the duckdb’s <code>df</code> is still not updated, you can (always) ‘register’ the dataframe explicitly as <code>dbcon.register("df", df);</code></p>
</div>
</div>
</section>
<section id="accessing-files-with-duckdb" class="level1">
<h1>Accessing files with DuckDB</h1>
<p>Often times we have data stored either in DB or in <code>parquet/csv</code> formats and they could be huge or may not/barely fit in memory. Loading them with pandas incur significant memory overhead and also possibly <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/scale.html">creates multiple copies</a> when performing certain operations. With DuckDB, such files can be queried directly without any copying because of <a href="https://arrow.apache.org/blog/2021/12/03/arrow-duckdb/">direct integration with Apache Arrow</a>.</p>
<p>To demonstrate this, we’ll download an <a href="https://www.kaggle.com/datasets/yuanyuwendymu/airline-delay-and-cancellation-data-2009-2018">airline delay &amp; cancelation dataset from kaggle</a> (and place it under <code>data/airline_data/</code> folder). The compressed archive is about <code>~2GB</code> and when deflated, creates a couple of CSVs totalling <code>~8GB</code> of data.</p>
<p>Let’s have a quick look at the contents by loading a single csv file:</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2022-05-27T19:34:01.175371Z&quot;,&quot;start_time&quot;:&quot;2022-05-27T19:34:00.924914Z&quot;}" data-execution_count="14">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>select <span class="op">*</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> <span class="st">'./data/airline_data/2009.csv'</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>limit <span class="dv">5</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>FL_DATE</th>
      <th>OP_CARRIER</th>
      <th>OP_CARRIER_FL_NUM</th>
      <th>ORIGIN</th>
      <th>DEST</th>
      <th>CRS_DEP_TIME</th>
      <th>DEP_TIME</th>
      <th>DEP_DELAY</th>
      <th>TAXI_OUT</th>
      <th>WHEELS_OFF</th>
      <th>...</th>
      <th>CRS_ELAPSED_TIME</th>
      <th>ACTUAL_ELAPSED_TIME</th>
      <th>AIR_TIME</th>
      <th>DISTANCE</th>
      <th>CARRIER_DELAY</th>
      <th>WEATHER_DELAY</th>
      <th>NAS_DELAY</th>
      <th>SECURITY_DELAY</th>
      <th>LATE_AIRCRAFT_DELAY</th>
      <th>Unnamed: 27</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2009-01-01</td>
      <td>XE</td>
      <td>1204</td>
      <td>DCA</td>
      <td>EWR</td>
      <td>1100</td>
      <td>1058.0</td>
      <td>-2.0</td>
      <td>18.0</td>
      <td>1116.0</td>
      <td>...</td>
      <td>62.0</td>
      <td>68.0</td>
      <td>42.0</td>
      <td>199.0</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2009-01-01</td>
      <td>XE</td>
      <td>1206</td>
      <td>EWR</td>
      <td>IAD</td>
      <td>1510</td>
      <td>1509.0</td>
      <td>-1.0</td>
      <td>28.0</td>
      <td>1537.0</td>
      <td>...</td>
      <td>82.0</td>
      <td>75.0</td>
      <td>43.0</td>
      <td>213.0</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2009-01-01</td>
      <td>XE</td>
      <td>1207</td>
      <td>EWR</td>
      <td>DCA</td>
      <td>1100</td>
      <td>1059.0</td>
      <td>-1.0</td>
      <td>20.0</td>
      <td>1119.0</td>
      <td>...</td>
      <td>70.0</td>
      <td>62.0</td>
      <td>36.0</td>
      <td>199.0</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2009-01-01</td>
      <td>XE</td>
      <td>1208</td>
      <td>DCA</td>
      <td>EWR</td>
      <td>1240</td>
      <td>1249.0</td>
      <td>9.0</td>
      <td>10.0</td>
      <td>1259.0</td>
      <td>...</td>
      <td>77.0</td>
      <td>56.0</td>
      <td>37.0</td>
      <td>199.0</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2009-01-01</td>
      <td>XE</td>
      <td>1209</td>
      <td>IAD</td>
      <td>EWR</td>
      <td>1715</td>
      <td>1705.0</td>
      <td>-10.0</td>
      <td>24.0</td>
      <td>1729.0</td>
      <td>...</td>
      <td>105.0</td>
      <td>77.0</td>
      <td>40.0</td>
      <td>213.0</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 28 columns</p>
</div>
</div>
</div>
<p>we can load efficiently with pandas too by specifying the <code>nrows</code> parameter:</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2022-05-27T19:34:05.133414Z&quot;,&quot;start_time&quot;:&quot;2022-05-27T19:34:05.097132Z&quot;}" data-execution_count="15">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>pd.read_csv(<span class="st">'./data/airline_data/2009.csv'</span>, nrows<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>FL_DATE</th>
      <th>OP_CARRIER</th>
      <th>OP_CARRIER_FL_NUM</th>
      <th>ORIGIN</th>
      <th>DEST</th>
      <th>CRS_DEP_TIME</th>
      <th>DEP_TIME</th>
      <th>DEP_DELAY</th>
      <th>TAXI_OUT</th>
      <th>WHEELS_OFF</th>
      <th>...</th>
      <th>CRS_ELAPSED_TIME</th>
      <th>ACTUAL_ELAPSED_TIME</th>
      <th>AIR_TIME</th>
      <th>DISTANCE</th>
      <th>CARRIER_DELAY</th>
      <th>WEATHER_DELAY</th>
      <th>NAS_DELAY</th>
      <th>SECURITY_DELAY</th>
      <th>LATE_AIRCRAFT_DELAY</th>
      <th>Unnamed: 27</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2009-01-01</td>
      <td>XE</td>
      <td>1204</td>
      <td>DCA</td>
      <td>EWR</td>
      <td>1100</td>
      <td>1058.0</td>
      <td>-2.0</td>
      <td>18.0</td>
      <td>1116.0</td>
      <td>...</td>
      <td>62.0</td>
      <td>68.0</td>
      <td>42.0</td>
      <td>199.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2009-01-01</td>
      <td>XE</td>
      <td>1206</td>
      <td>EWR</td>
      <td>IAD</td>
      <td>1510</td>
      <td>1509.0</td>
      <td>-1.0</td>
      <td>28.0</td>
      <td>1537.0</td>
      <td>...</td>
      <td>82.0</td>
      <td>75.0</td>
      <td>43.0</td>
      <td>213.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2009-01-01</td>
      <td>XE</td>
      <td>1207</td>
      <td>EWR</td>
      <td>DCA</td>
      <td>1100</td>
      <td>1059.0</td>
      <td>-1.0</td>
      <td>20.0</td>
      <td>1119.0</td>
      <td>...</td>
      <td>70.0</td>
      <td>62.0</td>
      <td>36.0</td>
      <td>199.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2009-01-01</td>
      <td>XE</td>
      <td>1208</td>
      <td>DCA</td>
      <td>EWR</td>
      <td>1240</td>
      <td>1249.0</td>
      <td>9.0</td>
      <td>10.0</td>
      <td>1259.0</td>
      <td>...</td>
      <td>77.0</td>
      <td>56.0</td>
      <td>37.0</td>
      <td>199.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2009-01-01</td>
      <td>XE</td>
      <td>1209</td>
      <td>IAD</td>
      <td>EWR</td>
      <td>1715</td>
      <td>1705.0</td>
      <td>-10.0</td>
      <td>24.0</td>
      <td>1729.0</td>
      <td>...</td>
      <td>105.0</td>
      <td>77.0</td>
      <td>40.0</td>
      <td>213.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 28 columns</p>
</div>
</div>
</div>
<p>While the first operation with DuckDB took <code>~250ms</code>, the second one above took only <code>~50ms</code>. It’s possibly because such operations are optimized in pandas and also for computing simple metrics across rows (such as mean, min, max etc.), pandas can make use of highly optimized numpy routines under the hood. But, as we’ll see later, these would only go so far.</p>
<p>To load all these CSVs into one dataframe with pandas is very inefficient and takes a lot of time. And it’ll most likely fail if your computer doesn’t have a beefy RAM. If you still gotta do it, you’d have to iterate through all CSVs and concatenate like so:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> glob <span class="im">import</span> glob</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>csvs <span class="op">=</span> glob(<span class="st">'data/airline_data/*.csv'</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.concat(pd.read_csv(csv) <span class="cf">for</span> csv <span class="kw">in</span> csvs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A better alternative would be to merge all those CSVs into a single parquet file. Unlike CSVs, parquet files are structured and as such are unambiguous to read.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> They are compressed columnar files and hence take much less space than individual CSVs combined because of the efficient Arrow data format.</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>sql copy <span class="st">'data/airline_data/*.csv'</span> to <span class="st">'data/airline_data/data.parquet'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>61556964</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Notice that we directly copied all the CSVs using regex to a single parquet file without ever copying data into pandas. Now, we ended up from a 7.5GB combined CSV files to a 2.5GB parquet file which now easily fits into memory. So we can load it with pandas as:</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2022-05-27T19:34:38.545606Z&quot;,&quot;start_time&quot;:&quot;2022-05-27T19:34:17.672753Z&quot;}" data-execution_count="17">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_parquet(<span class="st">'data/airline_data/data.parquet'</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>df.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>(61556964, 28)</code></pre>
</div>
</div>
<p>Because of the efficient parquet format, we could load the entire <em>61 Million</em> rows of data in mere seconds.</p>
<section id="projection-filter-pushdowns" class="level2">
<h2 class="anchored" data-anchor-id="projection-filter-pushdowns">Projection &amp; Filter Pushdowns</h2>
<p>Now let’s do a simple filter operation on our dataset. Let’s count the total number of rows that satisfy the condition <code>TAXI_OUT &gt; 10</code>. We’ll try with both pandas &amp; duckdb.</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2022-05-27T19:34:54.249748Z&quot;,&quot;start_time&quot;:&quot;2022-05-27T19:34:44.719959Z&quot;}" data-execution_count="18">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df[df[<span class="st">'TAXI_OUT'</span>] <span class="op">&gt;</span> <span class="dv">10</span>].shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>(45209245, 28)</code></pre>
</div>
</div>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2022-05-27T19:34:54.499992Z&quot;,&quot;start_time&quot;:&quot;2022-05-27T19:34:54.252243Z&quot;}" data-execution_count="19">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>select count(<span class="op">*</span>) <span class="im">as</span> count</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> df</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>where TAXI_OUT <span class="op">&gt;</span> <span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>45209245</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>While the earlier operation took <code>~9.5s</code>, the latter just took <strong>~250ms</strong> :zap:. <em>There’s just no comparison.</em></p>
<p>This is because duckdb automatically optimizes the query by selecting only the required column(s) (aka <code>projection pushdown</code>) and then applies the filtering to get a subset of data (aka <code>filter pushdown</code>). Pandas instead reads through all the columns. We can optimize this in pandas by doing these pushdowns ourselves.</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2022-05-27T19:35:13.066902Z&quot;,&quot;start_time&quot;:&quot;2022-05-27T19:35:12.209341Z&quot;}" data-execution_count="20">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>projection_pushdown_df <span class="op">=</span> df[[<span class="st">'TAXI_OUT'</span>]]</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>filter_pushdown_df <span class="op">=</span> projection_pushdown_df[projection_pushdown_df[<span class="st">'TAXI_OUT'</span>] <span class="op">&gt;</span> <span class="dv">10</span>]</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>filter_pushdown_df.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>(45209245, 1)</code></pre>
</div>
</div>
<p>We managed to bring this down from several seconds to almost a second. But using duckdb is still about <code>70-90%</code> faster than this.</p>
</section>
<section id="using-groupby" class="level2">
<h2 class="anchored" data-anchor-id="using-groupby">Using Groupby</h2>
<p>Now let’s calculate a few aggregates using <code>groupby</code> with projection &amp; filter pushdowns combined.</p>
<p>Here, we compute a few simple metrics with a certain airline carrier grouped by two origin &amp; destination airports and finally sort the results by the origin airport.</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2022-05-27T19:45:43.525554Z&quot;,&quot;start_time&quot;:&quot;2022-05-27T19:45:36.613608Z&quot;}" data-execution_count="22">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>projection_df <span class="op">=</span> df[[<span class="st">'ORIGIN'</span>, <span class="st">'DEST'</span>, <span class="st">'TAXI_OUT'</span>, </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'AIR_TIME'</span>, <span class="st">'DISTANCE'</span>, <span class="st">'OP_CARRIER'</span>]]</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>origin_df <span class="op">=</span> projection_df[</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    (projection_df[<span class="st">'ORIGIN'</span>].isin((<span class="st">'DCA'</span>, <span class="st">'EWR'</span>))) <span class="op">&amp;</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    (projection_df[<span class="st">'DEST'</span>].isin((<span class="st">'DCA'</span>, <span class="st">'EWR'</span>))) <span class="op">&amp;</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    (projection_df[<span class="st">'OP_CARRIER'</span>] <span class="op">==</span> <span class="st">'XE'</span>)]</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>(origin_df</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>     .groupby([<span class="st">'ORIGIN'</span>, <span class="st">'DEST'</span>])</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>     .agg(</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>         avg_taxi_out<span class="op">=</span>(<span class="st">'TAXI_OUT'</span>, <span class="st">'mean'</span>),</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>         max_air_time<span class="op">=</span>(<span class="st">'AIR_TIME'</span>, <span class="st">'max'</span>),</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>         total_distance<span class="op">=</span>(<span class="st">'DISTANCE'</span>, <span class="st">'sum'</span>))</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>     .sort_index(level<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th>avg_taxi_out</th>
      <th>max_air_time</th>
      <th>total_distance</th>
    </tr>
    <tr>
      <th>ORIGIN</th>
      <th>DEST</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>DCA</th>
      <th>EWR</th>
      <td>22.116009</td>
      <td>87.0</td>
      <td>828835.0</td>
    </tr>
    <tr>
      <th>EWR</th>
      <th>DCA</th>
      <td>23.675481</td>
      <td>93.0</td>
      <td>831024.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>We can make it a bit more concise by using <code>.query</code> for filtering pushdown.</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2022-05-27T19:46:08.269756Z&quot;,&quot;start_time&quot;:&quot;2022-05-27T19:46:04.842405Z&quot;}" data-execution_count="23">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>(df</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a> .query(<span class="st">'OP_CARRIER == "XE" and ORIGIN in ("DCA", "EWR") and DEST in ("DCA", "EWR")'</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a> .groupby([<span class="st">'ORIGIN'</span>, <span class="st">'DEST'</span>])</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a> .agg(</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>     avg_taxi_out<span class="op">=</span>(<span class="st">'TAXI_OUT'</span>, <span class="st">'mean'</span>),</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>     max_air_time<span class="op">=</span>(<span class="st">'AIR_TIME'</span>, <span class="st">'max'</span>),</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>     total_distance<span class="op">=</span>(<span class="st">'DISTANCE'</span>, <span class="st">'sum'</span>))</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th>avg_taxi_out</th>
      <th>max_air_time</th>
      <th>total_distance</th>
    </tr>
    <tr>
      <th>ORIGIN</th>
      <th>DEST</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>DCA</th>
      <th>EWR</th>
      <td>22.116009</td>
      <td>87.0</td>
      <td>828835.0</td>
    </tr>
    <tr>
      <th>EWR</th>
      <th>DCA</th>
      <td>23.675481</td>
      <td>93.0</td>
      <td>831024.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>This approach took only about half the time (~3s) compared to our earlier one because&nbsp;<code>.query</code> uses a modified syntax of python and also indexing thus resulting in more efficient evaluation. We can now compare that to our SQL counterpart…</p>
<div class="cell" data-executetime="{&quot;end_time&quot;:&quot;2022-05-27T19:47:12.947960Z&quot;,&quot;start_time&quot;:&quot;2022-05-27T19:47:12.518760Z&quot;}" data-execution_count="24">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>select</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    ORIGIN,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    DEST,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    AVG(TAXI_OUT) <span class="im">as</span> avg_taxi_out,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    MAX(AIR_TIME) <span class="im">as</span> max_air_time,</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    SUM(DISTANCE) <span class="im">as</span> total_distance</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> df</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>where</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    OP_CARRIER <span class="op">=</span> <span class="st">'XE'</span> <span class="kw">and</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    ORIGIN <span class="kw">in</span> (<span class="st">'DCA'</span>, <span class="st">'EWR'</span>) <span class="kw">and</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    DEST <span class="kw">in</span> (<span class="st">'DCA'</span>, <span class="st">'EWR'</span>)</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>group by ORIGIN, DEST</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>order by ORIGIN</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>ORIGIN</th>
      <th>DEST</th>
      <th>avg_taxi_out</th>
      <th>max_air_time</th>
      <th>total_distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>DCA</td>
      <td>EWR</td>
      <td>22.116009</td>
      <td>87.0</td>
      <td>828835.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>EWR</td>
      <td>DCA</td>
      <td>23.675481</td>
      <td>93.0</td>
      <td>831024.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>This ~400ms execution with duckdb above is around an <strong><em>order of magnitude faster</em></strong> and also a lot cleaner, I’d say. :wink:</p>
<p>Notice that the data is already loaded under <code>df</code> and hence we don’t need to read from the source parquet file.</p>
<blockquote class="blockquote">
<p>In the same way, we can also improve the performance of our queries <em>drastically</em> when using <strong><em>joins</em></strong> across multiple tables. I leave this as an exercise to the reader.</p>
</blockquote>
<p><em>But why actually load data into memory in the first place when we can process it more efficiently with it being just on disk?</em> Often times, the data is too big to load into memory anyways.</p>
<p>To do that, we just need to create a <code>VIEW</code> to our data which lets us query the table directly without loading onto memory and update the source from the dataframe <code>df</code> to the newly created view instead.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
</section>
</section>
<section id="accessing-data-with-views" class="level1">
<h1>Accessing data with <code>Views</code></h1>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>create view airlinedata <span class="im">as</span> select <span class="op">*</span> <span class="im">from</span> <span class="st">'data/airline_data/data.parquet'</span><span class="op">;</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>select</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    ORIGIN,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    DEST,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    AVG(TAXI_OUT) <span class="im">as</span> avg_taxi_out,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    MAX(AIR_TIME) <span class="im">as</span> max_air_time,</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    SUM(DISTANCE) <span class="im">as</span> total_distance</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> airlinedata</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>where</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    OP_CARRIER <span class="op">=</span> <span class="st">'XE'</span> <span class="kw">and</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>    ORIGIN <span class="kw">in</span> (<span class="st">'DCA'</span>, <span class="st">'EWR'</span>) <span class="kw">and</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    DEST <span class="kw">in</span> (<span class="st">'DCA'</span>, <span class="st">'EWR'</span>)</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="op">--</span> you can also use `ALL` instead of each column</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>group by ALL</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>order by ORIGIN</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>ORIGIN</th>
      <th>DEST</th>
      <th>avg_taxi_out</th>
      <th>max_air_time</th>
      <th>total_distance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>DCA</td>
      <td>EWR</td>
      <td>22.116009</td>
      <td>87.0</td>
      <td>828835.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>EWR</td>
      <td>DCA</td>
      <td>23.675481</td>
      <td>93.0</td>
      <td>831024.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>This is such a powerful feature and allows us to explore <em>lot</em> more data than traditionally possible with pandas.</p>
<p>We can also check the datatypes and other metadata with <code>describe view/table name</code></p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co">#collapse-output</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>sql describe airlinedata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>column_name</th>
      <th>column_type</th>
      <th>null</th>
      <th>key</th>
      <th>default</th>
      <th>extra</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>FL_DATE</td>
      <td>DATE</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>OP_CARRIER</td>
      <td>VARCHAR</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>OP_CARRIER_FL_NUM</td>
      <td>INTEGER</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ORIGIN</td>
      <td>VARCHAR</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>DEST</td>
      <td>VARCHAR</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>5</th>
      <td>CRS_DEP_TIME</td>
      <td>INTEGER</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>6</th>
      <td>DEP_TIME</td>
      <td>DOUBLE</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>7</th>
      <td>DEP_DELAY</td>
      <td>DOUBLE</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>8</th>
      <td>TAXI_OUT</td>
      <td>DOUBLE</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>9</th>
      <td>WHEELS_OFF</td>
      <td>DOUBLE</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>10</th>
      <td>WHEELS_ON</td>
      <td>DOUBLE</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>11</th>
      <td>TAXI_IN</td>
      <td>DOUBLE</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>12</th>
      <td>CRS_ARR_TIME</td>
      <td>INTEGER</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>13</th>
      <td>ARR_TIME</td>
      <td>DOUBLE</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>14</th>
      <td>ARR_DELAY</td>
      <td>DOUBLE</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>15</th>
      <td>CANCELLED</td>
      <td>DOUBLE</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>16</th>
      <td>CANCELLATION_CODE</td>
      <td>VARCHAR</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>17</th>
      <td>DIVERTED</td>
      <td>DOUBLE</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>18</th>
      <td>CRS_ELAPSED_TIME</td>
      <td>DOUBLE</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>19</th>
      <td>ACTUAL_ELAPSED_TIME</td>
      <td>DOUBLE</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>20</th>
      <td>AIR_TIME</td>
      <td>DOUBLE</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>21</th>
      <td>DISTANCE</td>
      <td>DOUBLE</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>22</th>
      <td>CARRIER_DELAY</td>
      <td>DOUBLE</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>23</th>
      <td>WEATHER_DELAY</td>
      <td>DOUBLE</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>24</th>
      <td>NAS_DELAY</td>
      <td>DOUBLE</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>25</th>
      <td>SECURITY_DELAY</td>
      <td>DOUBLE</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>26</th>
      <td>LATE_AIRCRAFT_DELAY</td>
      <td>DOUBLE</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>27</th>
      <td>Unnamed: 27</td>
      <td>VARCHAR</td>
      <td>YES</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section id="using-approximations" class="level2">
<h2 class="anchored" data-anchor-id="using-approximations">Using approximations</h2>
<p>At times, it suffices just to get an estimate of certain data rather than a precise answer. Using approximations would help us to just that.</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>select</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    OP_CARRIER,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    approx_count_distinct(DEST) <span class="im">as</span> approx_num_unique_destinations</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> airlinedata</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>group by <span class="dv">1</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>order by <span class="dv">1</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>limit <span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>OP_CARRIER</th>
      <th>approx_num_unique_destinations</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>9E</td>
      <td>186</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AA</td>
      <td>116</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AS</td>
      <td>77</td>
    </tr>
    <tr>
      <th>3</th>
      <td>B6</td>
      <td>73</td>
    </tr>
    <tr>
      <th>4</th>
      <td>CO</td>
      <td>85</td>
    </tr>
    <tr>
      <th>5</th>
      <td>DL</td>
      <td>171</td>
    </tr>
    <tr>
      <th>6</th>
      <td>EV</td>
      <td>205</td>
    </tr>
    <tr>
      <th>7</th>
      <td>F9</td>
      <td>130</td>
    </tr>
    <tr>
      <th>8</th>
      <td>FL</td>
      <td>75</td>
    </tr>
    <tr>
      <th>9</th>
      <td>G4</td>
      <td>126</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>select</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    OP_CARRIER,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">--</span> takes more time to compute</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    count(distinct DEST) <span class="im">as</span> num_unique_destinations</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> airlinedata</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>group by <span class="dv">1</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>order by <span class="dv">1</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>limit <span class="dv">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>OP_CARRIER</th>
      <th>num_unique_destinations</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>9E</td>
      <td>185</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AA</td>
      <td>116</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AS</td>
      <td>77</td>
    </tr>
    <tr>
      <th>3</th>
      <td>B6</td>
      <td>73</td>
    </tr>
    <tr>
      <th>4</th>
      <td>CO</td>
      <td>85</td>
    </tr>
    <tr>
      <th>5</th>
      <td>DL</td>
      <td>170</td>
    </tr>
    <tr>
      <th>6</th>
      <td>EV</td>
      <td>205</td>
    </tr>
    <tr>
      <th>7</th>
      <td>F9</td>
      <td>129</td>
    </tr>
    <tr>
      <th>8</th>
      <td>FL</td>
      <td>75</td>
    </tr>
    <tr>
      <th>9</th>
      <td>G4</td>
      <td>126</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Our approximation query earlier ran about 3-4 times faster than the precise one in this case. This is crucial when responsiveness is more important than precision (esp.&nbsp;for larger datasets).</p>
</section>
<section id="using-window-functions" class="level2">
<h2 class="anchored" data-anchor-id="using-window-functions">Using Window functions</h2>
<p>Finally, let’s wrap our analysis by showing off a bit more of what duckdb can do using some advanced SQL operations.</p>
<p>We create two CTEs (Common Table Expressions) to calculate a couple of features. We do filter &amp; projection pushdowns in one CTE and compute our desired features in another. The first feature is a simple demo to showcase <code>if-else</code> support. The second feature is a bit advanced where we find out the last destination a given air carrier has flown to, sorted by flying date. And when it doesn’t exist, replace it with <code>NA</code>. We then take a sample from the final resultant set.</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>sql</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> limited_data <span class="im">as</span> (</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    select </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>        FL_DATE,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>        ORIGIN, </span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>        DEST, </span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>        DISTANCE,</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>        OP_CARRIER,</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> airlinedata</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    where FL_DATE <span class="op">&gt;=</span> <span class="st">'2015-01-01'</span>    </span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>last_destination_data <span class="im">as</span> (</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    select <span class="op">*</span>,</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>        case</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>            when DISTANCE<span class="op">*</span><span class="fl">1.60934</span> <span class="op">&gt;</span> <span class="dv">500</span> then <span class="st">'yes'</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="st">'no'</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>        end <span class="im">as</span> distance_more_than_500_km,</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>        coalesce(last_value(DEST) over (</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>            partition by OP_CARRIER</span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>            order by FL_DATE</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>            rows between unbounded preceding <span class="kw">and</span> <span class="dv">1</span> preceding</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>        ), <span class="st">'NA'</span>) <span class="im">as</span> last_destination_flown_with_this_carrier</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>    <span class="im">from</span> limited_data</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>select <span class="op">*</span></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> last_destination_data</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>using sample <span class="dv">10</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>FL_DATE</th>
      <th>ORIGIN</th>
      <th>DEST</th>
      <th>DISTANCE</th>
      <th>OP_CARRIER</th>
      <th>distance_more_than_500_km</th>
      <th>last_destination_flown_with_this_carrier</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2018-07-10</td>
      <td>DCA</td>
      <td>LGA</td>
      <td>214.0</td>
      <td>YX</td>
      <td>no</td>
      <td>DCA</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2015-05-08</td>
      <td>DAL</td>
      <td>BWI</td>
      <td>1209.0</td>
      <td>WN</td>
      <td>yes</td>
      <td>BWI</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2018-03-30</td>
      <td>LAS</td>
      <td>SJC</td>
      <td>386.0</td>
      <td>WN</td>
      <td>yes</td>
      <td>SJC</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2015-07-10</td>
      <td>BOS</td>
      <td>MSP</td>
      <td>1124.0</td>
      <td>DL</td>
      <td>yes</td>
      <td>DTW</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2016-06-01</td>
      <td>DTW</td>
      <td>BWI</td>
      <td>409.0</td>
      <td>DL</td>
      <td>yes</td>
      <td>DTW</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2017-07-26</td>
      <td>GEG</td>
      <td>MSP</td>
      <td>1175.0</td>
      <td>DL</td>
      <td>yes</td>
      <td>SAN</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2017-01-10</td>
      <td>DFW</td>
      <td>ACT</td>
      <td>89.0</td>
      <td>EV</td>
      <td>no</td>
      <td>DFW</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2015-01-01</td>
      <td>PHX</td>
      <td>DRO</td>
      <td>351.0</td>
      <td>OO</td>
      <td>yes</td>
      <td>BFL</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2018-05-06</td>
      <td>DFW</td>
      <td>MCO</td>
      <td>985.0</td>
      <td>AA</td>
      <td>yes</td>
      <td>IAH</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2018-04-30</td>
      <td>MSY</td>
      <td>LAX</td>
      <td>1670.0</td>
      <td>WN</td>
      <td>yes</td>
      <td>LAX</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Nice, isn’t it?! The same operation is unimaginably complex (for me, at least) in pandas. 🤯</p>
<p>With DuckDB, we can combine one or more of many of such complex operations and execute in one go without worrying much about manual optimizations.</p>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>We have noticed how performant DuckDB is and how it brings the whole SQL ecosystem into Pandas. Its simple installation and light footprint means that we can integrate this into our existing workflows with minimal effort and achieve maximum gains in terms of execution speeds&nbsp;. We can also continue using pandas on larger datasets without loading them into memory or jumping onto a full blown distributed computing setup (<em>for a reasonable extent</em>).</p>
<p>Thanks so much for reading this far :heart:. Now you know most of the important stuff about DuckDB to get yourself started. Bear in mind that we hardly scratched the surface. DuckDB offers so much more. You can use correlated subqueries, nested types, etc. apart from its many <a href="https://duckdb.org/2022/05/04/friendlier-sql.html">user friendly features</a> such as column aliasing in <code>group by/having</code>, auto-incrementing duplicate columns, better string slicing and so on. Their <a href="https://duckdb.org/docs/">documentation</a> is very clean &amp; beginner friendly and the <a href="https://duckdb.org/news/">blog</a> has very informative posts as well. I encourage you to check those out.</p>
<section id="sidenote" class="level3">
<h3 class="anchored" data-anchor-id="sidenote">Sidenote</h3>
<ul>
<li><a href="https://modin.org/">Modin</a> tries to parallellize pandas workflow by distributing the workload to multiple CPU cores. <a href="https://www.kdnuggets.com/2019/11/speed-up-pandas-4x.html">Have a look</a> and am guessing that we can also combine modin &amp; DuckDB for an even faster runtimes.</li>
<li><a href="https://github.com/fugue-project/fugue">Fugue</a> is a new framework that provides a unified interface so that users can execute their Python, Pandas, and SQL code on various distributed computing platforms such as Spark and Dask without rewrites. Please check <a href="https://towardsdatascience.com/introducing-fugue-reducing-pyspark-developer-friction-a702230455de">here</a> for a nice introduction from its maintainer Kevin and also checkout <a href="https://towardsdatascience.com/fugue-and-duckdb-fast-sql-code-in-python-e2e2dfc0f8eb">this</a> article from Khuyen to get a feel of using it with DuckDB.</li>
</ul>
<p>I hope you have enjoyed this post and learnt something from it. Please let me know your thoughts/suggestions (or any mistakes) in the comments below. :)</p>
<p>Happy Ducking! 💚🦆💚</p>
</section>
</section>
<section id="footnotes" class="level1">
<h1>Footnotes</h1>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p><a href="https://duckdb.org/2021/05/14/sql-on-pandas.html">SQL on Pandas with duckdb</a><a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p><a href="https://duckdb.org/docs/archive/0.2.8/data/parquet">duckdb on parquet</a><a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>The exact execution times might vary a bit depending on the load &amp; build of your computer. I also noticed that the operations are cached and the first computation takes a bit of time but running it again or after changing the values of the columns in the <code>WHERE</code> clause would only take a couple of <code>ms</code> later on.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>